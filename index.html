<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOC TOC TOC - Oficial</title>
    <style>
        :root { --primary: #00796b; --bg: #e0f7fa; --alert: #d32f2f; --happy: #2e7d32; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; height: 100vh; }
        .app { width: 100%; max-width: 420px; background: white; height: 100%; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .tela { display: none; flex-direction: column; align-items: center; padding: 20px; height: 100%; overflow-y: auto; text-align: center; }
        .ativa { display: flex; }
        
        .tatu-visual { width: 180px; height: 180px; object-fit: contain; margin: 15px 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .btn-opcao { border: 3px solid #eee; border-radius: 20px; padding: 10px; cursor: pointer; background: #fff; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px; }
        .btn-opcao:active { transform: scale(0.95); border-color: var(--primary); }
        .btn-opcao img { width: 80px; height: 80px; object-fit: contain; }
        .btn-opcao p { font-size: 11px; font-weight: bold; margin: 8px 0 0; color: #555; line-height: 1.2; text-transform: uppercase; }
        
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 10px; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; padding: 15px; width: 100%; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        
        .log-card { background: #f1f8e9; border-left: 5px solid var(--primary); padding: 12px; margin-bottom: 12px; text-align: left; font-size: 12px; border-radius: 0 10px 10px 0; }
        
        /* Cores dos Alertas */
        .tag-alerta { background: var(--alert); color: white; padding: 3px 7px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .tag-feliz { background: var(--happy); color: white; padding: 3px 7px; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="app">

    <div id="t0" class="tela ativa">
        <h2 style="color:var(--primary)">Cadastro do Responsável</h2>
        <input type="text" id="p_nome" placeholder="Seu Nome">
        <input type="tel" id="p_zap" placeholder="WhatsApp">
        <input type="email" id="p_email" placeholder="E-mail">
        <input type="text" id="c_nome" placeholder="Apelido da Criança">
        <button class="btn-main" onclick="salvarCadastro()">SALVAR E COMEÇAR</button>
    </div>

    <div id="t1" class="tela">
        <h2>Como o Tatu está agora?</h2>
        <div class="grid">
            <div class="btn-opcao" onclick="fluxo('Sentimento', 'Feliz', 2, 'tatu_feliz.png')"><img src="tatu_feliz.png"><p>FELIZ</p></div>
            <div class="btn-opcao" onclick="fluxo('Sentimento', 'Triste', 2, 'tatu_triste.png')"><img src="tatu_triste.png"><p>TRISTE</p></div>
            <div class="btn-opcao" onclick="fluxo('Sentimento', 'Neutro', 2, 'tatu_neutro.png')"><img src="tatu_neutro.png"><p>NORMAL</p></div>
            <div class="btn-opcao" onclick="fluxo('Sentimento', 'Quero me Isolar', 2, 'tatu_enrolado.png')"><img src="tatu_enrolado.png"><p>QUERO ME ISOLAR</p></div>
        </div>
    </div>

    <div id="t2" class="tela">
        <h2>Onde o Tatu está?</h2>
        <img id="avatar-t2" class="tatu-visual">
        <div class="grid">
            <div class="btn-opcao" onclick="fluxo('Local', 'Sala de Aula', 3)"><img src="sala.png"><p>SALA</p></div>
            <div class="btn-opcao" onclick="fluxo('Local', 'Corredor', 3)"><img src="corredor.png"><p>CORREDOR</p></div>
            <div class="btn-opcao" onclick="fluxo('Local', 'Pátio', 3)"><img src="patio.png"><p>PÁTIO</p></div>
            <div class="btn-opcao" onclick="fluxo('Local', 'Banheiro', 3)"><img src="banheiro.png"><p>BANHEIRO</p></div>
        </div>
    </div>

    <div id="t3" class="tela">
        <h2>E a porta, como está para você?</h2>
        <img id="avatar-t3" class="tatu-visual">
        <div class="grid">
            <div class="btn-opcao" onclick="fluxo('Porta', 'Aberta', 4)"><img src="porta_aberta.png"><p>ABERTA</p></div>
            <div class="btn-opcao" onclick="fluxo('Porta', 'Fechada (Exclusão)', 4)"><img src="porta_fechada.png"><p>FECHADA</p></div>
            <div class="btn-opcao" onclick="fluxo('Porta', 'Batendo (Toc Toc)', 4)"><img src="porta_batida.png"><p>BATENDO</p></div>
        </div>
    </div>

    <div id="t4" class="tela">
        <h2>Quem estava lá?</h2>
        <div class="grid">
            <div class="btn-opcao" onclick="fluxo('Agente', 'Professora', 5)"><img src="professora.png"><p>PROFESSORA</p></div>
            <div class="btn-opcao" onclick="fluxo('Agente', 'Colegas', 5)"><img src="grupo_unido.png"><p>COLEGAS</p></div>
            <div class="btn-opcao" onclick="fluxo('Bullying', 'Riram de mim', 5)"><img src="grupo_bullying.png"><p>RIRAM</p></div>
            <div class="btn-opcao" onclick="fluxo('Bullying', 'Fiquei sozinho', 5)"><img src="grupo_sozinho.png"><p>ISOLADO</p></div>
        </div>
    </div>

    <div id="t5" class="tela">
        <h2>O corpo sente...</h2>
        <div class="grid">
            <div class="btn-opcao" onclick="fluxo('Corpo', 'Felicidade', 6, 'tatu_feliz.png')"><img src="tatu_feliz.png"><p>FELICIDADE</p></div>
            <div class="btn-opcao" onclick="fluxo('Corpo', 'Nó na garganta', 6, 'tatu_enrolado.png')"><img src="sensacao_no.png"><p>NÓ NA GARGANTA</p></div>
            <div class="btn-opcao" onclick="fluxo('Corpo', 'Raiva', 6, 'tatu_triste.png')"><img src="sensacao_raio.png"><p>RAIVA</p></div>
            <div class="btn-opcao" onclick="fluxo('Corpo', 'Choro', 6, 'tatu_triste.png')"><img src="sensacao_lagrimas.png"><p>CHORO</p></div>
        </div>
    </div>

    <div id="t6" class="tela">
        <h2 style="color:var(--primary)">Relatório Clínica</h2>
        <div id="painel-clinico" style="width:100%"></div>
        <button class="btn-main" onclick="location.reload()">NOVA BATIDA</button>
    </div>

</div>

<script>
    let dadosRelato = [];
    let imgEstado = 'tatu_neutro.png';

    if(localStorage.getItem('toctoc_config')) { 
        document.getElementById('t0').classList.remove('ativa');
        document.getElementById('t1').classList.add('ativa');
    }

    function salvarCadastro() {
        const c = { pai: document.getElementById('p_nome').value, crianca: document.getElementById('c_nome').value };
        if(!c.pai || !c.crianca) return alert("Preencha o cadastro.");
        localStorage.setItem('toctoc_config', JSON.stringify(c));
        location.reload();
    }

    function fluxo(cat, val, prox, img = null) {
        if(img) imgEstado = img;
        dadosRelato.push({cat: cat, val: val});
        document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
        document.getElementById('t'+prox).classList.add('ativa');
        const av = document.getElementById('avatar-t' + prox);
        if(av) av.src = imgEstado;
        if(prox === 6) finalizar();
    }

    function finalizar() {
        const h = JSON.parse(localStorage.getItem('toctoc_hist')) || [];
        h.push({ data: new Date().toLocaleString('pt-BR'), itens: [...dadosRelato], crianca: JSON.parse(localStorage.getItem('toctoc_config')).crianca });
        localStorage.setItem('toctoc_hist', JSON.stringify(h));
        
        const container = document.getElementById('painel-clinico');
        container.innerHTML = h.reverse().map(l => {
            // LÓGICA DE ALERTA CORRIGIDA
            let tag = "";
            const sent = l.itens.find(i => i.cat === 'Sentimento').val;
            
            if (sent === 'Feliz') {
                tag = '<span class="tag-feliz">ALERTA DE FELICIDADE</span>';
            } else if (l.itens.find(i => i.val.includes("Fechada") || i.val.includes("Professora") || i.val.includes("Riram"))) {
                tag = '<span class="tag-alerta">ALERTA DE EXCLUSÃO/TRAUMA</span>';
            }

            return `
                <div class="log-card">
                    <strong>${l.data} - ${l.crianca}</strong> ${tag}<br>
                    ${l.itens.map(i => `• ${i.cat}: ${i.val}`).join('<br>')}
                </div>
            `;
        }).join('');
    }
</script>
</body>
</html>
